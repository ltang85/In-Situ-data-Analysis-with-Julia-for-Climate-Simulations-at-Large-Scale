
% JuliaCon proceedings template
\documentclass{juliacon}
\setcounter{page}{1}
\usepackage{xurl}
\usepackage{amsmath}
%\usepackage[ruled,vlined]{algorithm2e}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}

\usepackage{booktabs}
\usepackage[width=.45\textwidth]{caption}

\usepackage{graphicx}
\graphicspath{{../figures/}}

\begin{document}

\input{header}

\maketitle

\begin{abstract}


Fast-evolving data science techniques have enabled scientific discoveries by providing the ability to analyze large amounts of scientific data and extract relevant patterns. However, the ever-increasing gap between computing speed, which continues to increase, and data input/output (I/O) bandwidth, which remains relatively constant, often prevents full utilization of the data; we are likely unable to save all of the generated data for analysis. In situ data analysis techniques seek to address this issue by completing analysis and pattern extraction from generated scientific data while the application is running, and the in situ data analysis only involves compute and in-memory data I/O, which improves performance. In this paper, we develop an infrastructure for coupling a popular high-level data science programming language, Julia, with the large-scale production-level climate code Energy Exascale Earth System Model (E3SM). To demonstrate the infrastructure, we develop two in situ data analysis methods in Julia and evaluate their performance and the infrastructure overhead. Our results show that our in situ Julia data analysis methods are able to detect extreme weather events and characterize climate patterns with insignificant infrastructure overhead. Furthermore, our infrastructure allows user-friendly development and deployment of new Julia data analysis modules without the need to recompile the simulation code, giving data analysts a simple new tool for in situ analysis.

%\headingtable

\end{abstract}

\section{Introduction}

Computing devices are evolving much faster than storage devices because of their different ratios of performance improvement to Research and Development (R\&D) investment in the post-Moore’s Law era~\cite{thompson2018decline}. This trend enlarges the performance gap between our computing and storage devices and greatly limits our ability to analyze all the generated scientific simulation data. When run on High-Performance Computing (HPC) systems, modern physics simulations employ thousands of nodes, generating large amounts of data. For example, at a high resolution, the three-dimensional physics model state alone can be tens of gigabytes \emph{per} time slice. While this data could possibly be compressed and then stored with high-performance input/output (I/O) for post-processing~\cite{jin2022accelerating,scorpio}, data movement and post-processing time can be extremely long. To address these issues, we adopt in situ data analysis to analyze physics simulation data as the simulation is running. The in situ data analysis design involves several design and performance tarde-offs in terms of coupling the physics simulation and data analysis, and we will explore some of the trade-offs in this paper.



Our target HPC application is Energy Exascale Earth System Model (E3SM)~\cite{golaz2019doe}. E3SM is the Department of Energy (DOE) state-of-the-science earth system model, and we focus on E3SM's atmosphere component (EAM) in this study. Developing data science techniques is extremely costly by using HPC programming languages such as C/C++ and Fortran due to the ecosystem lacking, so most data analysis programs are implemented by using Python. However, Python's performance is usually slow on HPC systems and we decided to use Julia as the programming language of developing data analysis modules because of its superior performance for data analysis and rich support of data analysis packages~\cite{hunold2020benchmarking}. Therefore, the major challenge of employing in situ data analysis to legacy scientific applications is that modern advanced data science techniques are usually not implemented in the same way as the HPC scientific codes. In this paper, we hypothesize that the Fortran-based EAM can be effectively coupled with in situ Julia-based data analysis modules on HPC systems.






To validate our hypothesis and demonstrate the in situ Julia data analysis infrastructure, we implement two in situ data analysis methods in Julia: (1) detection of Sudden Stratospheric Warming (SSW) with generalized extreme value (GEV) analysis, and (2) characterization of large-scale climate patterns via principal components analysis (PCA). SSW events are extreme events in the upper atmosphere (approximately 20km above ground level) that can cause the temperature to rise as much as 50$^o$C in only a few days.  This extreme warming can destabilize the polar vortex, which can in turn lead to rapid swings in surface air temperature. To identify SSWs, we developed an in situ analysis method that documents every occurrence when the zonal mean of the zonal wind becomes reversed (easterly) at 60°N and 10 hPa and lasts for at least 10 consecutive days in northern hemisphere winter. To characterize surface temperature changes that may result from SSWs, we fitted in situ generalized extreme value (GEV) models to the daily minimum surface temperatures at each spatial point in the continental United States (CONUS) via streaming variational inference~\cite{broderick2013streaming}. By updating two separate sets of models (one following SSWs and one not), we examined differences in extreme temperature behavior. Our second data analysis method focuses on PCA of the surface temperatures across the globe. PCA is a common statistical technique for identifying patterns in data that best explain variation in the data. Our TributaryPCA method estimates the top spatial principal component patterns in a streaming, distributed fashion~\cite{wang2021tributarypca}, whereas traditional analysis would need to save data from all spatial locations across many time steps to compute the principal components.


This paper presents a practical case study that uses Julia-based analysis in situ with a large-scale HPC application. The major benefit of this work is that it provides a reference design for coupling Julia with modern large-scale HPC applications which could be applied to other HPC applications with minimal effort.
In addition, data scientists could develop new Julia data analysis methods and insert them into the interface without recompiling the HPC code.
Another benefit of this work is an accurate and quantitative view of how the Julia infrastructure and coupling impact the original HPC application, which helps provide actionable guidance to HPC users before coupling Julia with their target HPC applications. To help HPC users adopt the in situ approach and Julia to meet their needs, this work provides the following key contributions:
\begin{enumerate}
\item We develop a novel in situ data analysis infrastructure for coupling E3SM with Julia for in situ data analysis at large-scale with high productivity.
\item We develop two in situ Julia data analysis methods for E3SM's EAM data at large-scale for identifying sudden stratospheric warmings and identifying dominant spatial patterns in temperature.
\item We evaluate the performance of this coupling infrastructure on a large-scale HPC system and study various design considerations, leading to guidelines for adopting Julia for in situ data analysis on other HPC applications.
\item We have open-sourced the code and instructions of reproducing this in situ data analysis with E3SM in \url{https://github.com/ltang85/In-Situ-data-Analysis-with-Julia-for-Climate-Simulations-at-Large-Scale/tree/main/src}.
\end{enumerate}


This paper is organized in the following structure. Section~\ref{sec2} provides the background information and discusses some related works. Section~\ref{sec3} presents the in situ infrastructure that couples the EAM and the in situ Julia modules. Section~\ref{sec4} describes the algorithms of our two in situ Julia modules. Section~\ref{sec5} shows the experimental results, and section~\ref{sec6} summarizes this paper.





\end{document}

% Inspired by the International Journal of Computer Applications template
